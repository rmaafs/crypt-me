name: Code Quality
on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master
jobs:
  code-quality:
    name: "ğŸ‘€ Code Quality"
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [12.x]

    steps:
      - name: ğŸ”½ Descargar proyecto
        uses: actions/checkout@v2
        with:
          persist-credential: false

      - name: ğŸ  Instalar Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v1
        with:
          node-version: ${{ matrix.node-version }}

      - name: ğŸ‘·â€â™‚ï¸ Instalar dependencias
        run: |
          npm ci
      - name: ğŸ”… Sintaxis estÃ¡ndar prettier
        run: |
          echo "Recuerda tener instalado Prettier como formateador de cÃ³digo en tu Editor de texto"
          echo "Este cÃ³digo usarÃ¡ como estÃ¡ndar la indentaciÃ³n de Prettier."
          echo "Para solucionar tu indentaciÃ³n, ejecuta npm run sintax:fix"
          npm run sintax:test
      - name: ğŸ‘€ Calidad del cÃ³digo
        run: |
          echo "Se revisarÃ¡ la calidad del cÃ³digo para que la consola no tenga warnings ni errores."
          echo "Se validarÃ¡ que no existan variables sin usar, console.logs, malos estÃ¡ndares de cÃ³digo, etc."
          npm run lint
  unit-test:
    needs: code-quality
    name: "ğŸ§ª Unit tests"
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [12.x]

    steps:
      - name: ğŸ‘€ EstÃ¡ndares del proyecto
        run: |
          npm test -- estandar.test.js
      - name: ğŸ‘€ Pruebas de conexiones
        env:
          MONGO_BD: ${{ secrets.MONGO_BD }}
        run: |
          npm test -- connections.test.js
          echo $MONGO_BD
